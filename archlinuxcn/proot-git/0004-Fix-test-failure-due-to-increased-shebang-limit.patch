From 7a94e8c374e50c68739f42be2a17c2039073fa82 Mon Sep 17 00:00:00 2001
From: Yichao Yu <yyc1992@gmail.com>
Date: Wed, 29 Sep 2021 21:24:25 -0400
Subject: [PATCH 04/10] Fix test failure due to increased shebang limit

On linux kernel 5.1+
---
 test/test-691786c8.sh | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/test/test-691786c8.sh b/test/test-691786c8.sh
index 94028ca..a7bb546 100644
--- a/test/test-691786c8.sh
+++ b/test/test-691786c8.sh
@@ -26,15 +26,17 @@ RESULT="$(${PROOT} ${TMP})"
 EXPECTED="$(${TMP})"
 
 [ "${RESULT}" = "${EXPECTED}" ]
-[ "${RESULT}" = "${TMP}" ]
 
 echo '#!/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../usr/bin/echo XXXXXXXXX' > "${TMP}"
 
-! ${PROOT} ${TMP}
-[ $? -eq 0 ]
-
-! ${TMP}
-[ $? -eq 0 ]
+if ${TMP}; then
+    # Linux kernel 5.1-rc1 increases the shebang limit to 256
+    [ "${RESULT}" = "XXXXXXXXX ${TMP}" ]
+    ${PROOT} ${TMP}
+else
+    [ "${RESULT}" = "${TMP}" ]
+    ! ${PROOT} ${TMP}
+fi
 
 echo '#!                                                                                                                                                                                                        ' > ${TMP}
 
-- 
2.33.0

