# Maintainer: Dct Mei <dctxmei@yandex.com>
# Contributor: Felix Yan <felixonmars@archlinux.org>

pkgname=xray-domain-list-community
pkgver=20210210155121
pkgrel=1
pkgdesc="A list of domains to be used as geosites for routing purpose in Project V"
arch=('any')
url="https://github.com/v2fly/domain-list-community"
license=('MIT')
makedepends=('git' 'go')
source=("${url}/archive/${pkgver}/${pkgname}-${pkgver}.tar.gz")
sha256sums=('2a9c45a236886ea2a1448be8d41a99fb539bf9a8f5956f2ee6f6ee1e8f5ba0a2')

prepare() {
    mkdir .gopath
    export GOPATH="${srcdir}"/.gopath

    mkdir -p .gopath/src/github.com/v2fly
    ln -s "${PWD}"/"domain-list-community-$pkgver" .gopath/src/github.com/v2fly/domain-list-community

    go get github.com/golang/protobuf/proto
    go get -insecure v2ray.com/core/app/router
}

build() {
    cd .gopath
    go run ./src/github.com/v2fly/domain-list-community/main.go
}

package() {
    cd .gopath
    install -Dm 644 dlc.dat "${pkgdir}"/usr/share/xray/geosite.dat
    install -Dm 644 "${srcdir}"/"domain-list-community-${pkgver}"/LICENSE -t "${pkgdir}"/usr/share/licenses/"$pkgname"/
}
